<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <title>Phiếu trả giá</title>
  <style>
    @page {
      size: A4;
      margin: 18mm 16mm;
    }

    html, body {
      margin: 0;
      padding: 0;
      background: #e5e7eb;
      font-family: "Times New Roman", Times, serif;
      font-size: 12.5pt;
      color: #000;
    }

    .page {
      width: 210mm;
      min-height: 297mm;
      margin: 10px auto;
      background: #fff;
      box-shadow: 0 0 6px rgba(0,0,0,0.18);
      box-sizing: border-box;
      padding: 18mm 16mm;
      position: relative;
      page-break-after: always;
    }

    @media print {
      html, body {
        background: #ffffff;
      }
      .page {
        margin: 0;
        box-shadow: none;
        page-break-after: always;
      }
    }

    .center { text-align: center; }
    .bold { font-weight: 700; }
    .title { font-size: 18pt; font-weight: 800; text-transform: uppercase; }
    .gov   { font-size: 15pt; font-weight: 800; text-transform: uppercase; }
    .mt-1  { margin-top: 3mm; }
    .mt-2  { margin-top: 4mm; }
    .mt-3  { margin-top: 6mm; }
    .mt-4  { margin-top: 8mm; }
    .mb-2  { margin-bottom: 4mm; }
    .small { font-size: 11pt; }
    .note  { font-size: 10.5pt; }

    .divider {
      text-align:center;
      margin: 2mm 0 6mm;
    }

    /* Box mã nhận dạng nhỏ ở góc trái trên */
    .flag-box {
      position: absolute;
      top: 10mm;
      left: 8mm;
      font-size: 9pt;
      border: 1px solid #444;
      padding: 2px 6px;
      line-height: 1.3;
      background: #f9fafb;
    }

    /* Dòng label: value dạng bảng */
    .info-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 2mm;
      margin-bottom: 2mm;
    }
    .info-table td {
      padding: 1mm 0;
      vertical-align: top;
    }
    .info-label {
      width: 45mm;
      white-space: nowrap;
      font-weight: 700;
    }
    .info-sep {
      width: 4mm;
    }

    /* Dòng chấm để người dùng điền */
    .dotline {
      display: inline-block;
      border-bottom: 0.6pt dotted #888;
      min-width: 45mm;
      line-height: 1.2;
    }
    .dotline.long {
      min-width: 120mm;
    }

    .signature-block {
      width: 60%;
      margin-left: auto;
      text-align: center;
      margin-top: 16mm;
      page-break-inside: avoid;
    }
  </style>
</head>
<body>

{% for t in tickets %}
  {% set auction_mode = t.auction_mode or 'PER_LOT' %}
  {% set is_per_sqm = (auction_mode == 'PER_SQM') %}
  {% set unit_label = is_per_sqm and 'VND/m²' or 'VND/lô' %}
  {% set price_unit = unit_label %}
  {% set bid_unit = unit_label %}
  {# số lô đủ điều kiện của khách trong dự án #}
  {% set qty_lots = t.customer_lot_count or 1 %}
  {# Chuẩn hóa lot_code: CL03-11 → CL03.11 #}
  {% set lot_short = (t.lot_code or '').replace('-', '.') %}
  {# STT: ưu tiên stt_padded, fallback stt #}
  {% set stt_code = t.stt_padded or (t.stt or '') %}

  <div class="page">

    <!-- Mã nhận dạng nhỏ góc trái: STT - C - S - lot -->
    <div class="flag-box">
      {{ stt_code }}-C{{ t.customer_id }}-S{{ qty_lots }}-{{ lot_short }}
    </div>

    <!-- Quốc hiệu -->
    <div class="center gov">CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</div>
    <div class="center bold">Độc lập – Tự do – Hạnh phúc</div>
    <div class="divider">-----------------o0o-----------------</div>

    <!-- Tiêu đề -->
    <div class="center title">PHIẾU TRẢ GIÁ</div>

    <!-- Tài sản đấu giá -->
    <div class="mt-3">
      <span class="bold">Tài sản đấu giá:</span>
      Quyền sử dụng đất thuộc dự án
      "<span class="bold">{{ t.project_name }}</span>",
      lô đất số <span class="bold">{{ t.lot_code }}</span>
      {% if t.area_m2 is number %}
        , diện tích <span class="bold">{{ "{:,.2f}".format(t.area_m2|float) }}</span> m².
      {% else %}
        .
      {% endif %}
    </div>

    <!-- Kính gửi -->
    <div class="mt-2">
      <span class="bold">Kính gửi:</span>
      {{ t.company_name or 'Công ty Đấu giá Hợp danh Kinh Đô' }}
    </div>

    <!-- Thông tin khách hàng -->
    <table class="info-table mt-2">
      <tr>
        <td class="info-label">Khách hàng tham gia ĐG</td>
        <td class="info-sep">:</td>
        <td>{{ t.customer_full_name or '' }}</td>
      </tr>
      <tr>
        <td class="info-label">CCCD/Căn cước</td>
        <td class="info-sep">:</td>
        <td>{{ t.cccd or '' }}</td>
      </tr>
      <tr>
        <td class="info-label">Địa chỉ</td>
        <td class="info-sep">:</td>
        <td>{{ t.address or '' }}</td>
      </tr>
      <tr>
        <td class="info-label">Số điện thoại</td>
        <td class="info-sep">:</td>
        <td>{{ t.phone or '' }}</td>
      </tr>
      <tr>
        <td class="info-label">Người được uỷ quyền<br/>(nếu có)</td>
        <td class="info-sep">:</td>
        <td><span class="dotline long">&nbsp;</span></td>
      </tr>
      <tr>
        <td class="info-label">CCCD người uỷ quyền</td>
        <td class="info-sep">:</td>
        <td><span class="dotline long">&nbsp;</span></td>
      </tr>
    </table>

    <!-- Đoạn cam kết đầu -->
    <div class="mt-2 small" style="text-align: justify;">
      Sau khi nghiên cứu kỹ hồ sơ mời tham gia đấu giá và xem tài sản đấu giá nêu trên,
      tôi quyết định trả giá như sau:
    </div>

    <!-- NỘI DUNG TRẢ GIÁ -->
    <div class="center bold mt-3">NỘI DUNG TRẢ GIÁ</div>

    <table class="info-table mt-1">
      <tr>
        <td class="info-label">Lô đất đăng ký ĐG</td>
        <td class="info-sep">:</td>
        <td class="bold">{{ t.lot_code }}</td>
      </tr>
      <tr>
        <td class="info-label">Giá khởi điểm ({{ price_unit }})</td>
        <td class="info-sep">:</td>
        <td>
          {% if t.starting_price_vnd is number %}
            {{ "{:,.0f}".format(t.starting_price_vnd|float) }}
          {% endif %}
        </td>
      </tr>
      <tr>
        <td class="info-label">Bước giá ({{ bid_unit }})</td>
        <td class="info-sep">:</td>
        <td>
          {% if t.bid_step_vnd is number %}
            {{ "{:,.0f}".format(t.bid_step_vnd|float) }}
          {% endif %}
        </td>
      </tr>
      <tr>
        <td class="info-label">Tôi xin trả giá là</td>
        <td class="info-sep">:</td>
        <td>
          <span class="dotline" style="min-width:65mm;">&nbsp;</span>
          &nbsp;{{ unit_label }}
        </td>
      </tr>
    </table>

    <div class="mt-1 small">
      Bằng chữ:
      <span class="dotline long">&nbsp;</span>
    </div>
    <div class="small">
      <span class="dotline long">&nbsp;</span> đồng.
    </div>

    <!-- Cam kết -->
    <div class="mt-3 small" style="text-align: justify;">
      Tôi cam kết hoàn toàn chịu trách nhiệm về mức giá đã trả trên Phiếu trả giá này
      và thực hiện nghiêm túc Quy chế đấu giá tài sản cùng các quy định pháp luật có liên quan.
    </div>

    <!-- Ghi chú -->
    <div class="mt-3 note">
      <span class="bold">Ghi chú:</span><br/>
      - Phiếu trả giá hợp lệ là phiếu có dấu treo của {{ t.company_name or 'Công ty Đấu giá Hợp danh Kinh Đô' }};<br/>
      - Phiếu không bị rách, nát;<br/>
      - Được điền đầy đủ các thông tin;<br/>
      - Trường hợp có sai lệch giữa giá trả bằng số với giá trả bằng chữ
        thì lấy giá trả bằng chữ để xét giá.
    </div>

    <!-- Chữ ký -->
    <div class="signature-block">
      ................................, ngày ...... tháng ...... năm ......<br/><br/>
      <span class="bold">Khách hàng tham gia đấu giá</span><br/>
      <span class="note">(Ký và ghi rõ họ tên)</span>
    </div>

  </div>
{% endfor %}

<script>
  window.addEventListener("load", function () {
    window.print();
  });
</script>
</body>
</html>

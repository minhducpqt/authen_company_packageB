{% extends "base.html" %}
{% block content %}
<div class="bg-white rounded-xl border border-slate-200 p-5">
  <div class="flex items-center justify-between mb-4">
    <div>
      <h2 class="text-xl font-semibold text-slate-800">Quản lý dự án</h2>
      <p class="text-slate-500 text-sm">Lọc theo trạng thái, tìm theo tên/mã.</p>
    </div>
    <div class="flex gap-2">
      <a href="/projects/template" class="topbtn border border-slate-300 bg-white text-slate-700">
        <i class="ri-download-2-line mr-1"></i> Template
      </a>
      <a href="/projects/export" class="topbtn border border-slate-300 bg-white text-slate-700">
        <i class="ri-download-cloud-2-line mr-1"></i> Export
      </a>
      <a href="/projects/import" class="topbtn bg-indigo-600 text-white hover:bg-indigo-700">
        <i class="ri-upload-2-line mr-1"></i> Import
      </a>
      <a href="/projects/create" class="topbtn bg-emerald-600 text-white hover:bg-emerald-700">
        <i class="ri-add-line mr-1"></i> Thêm dự án
      </a>
    </div>
  </div>

  {% if load_err %}
    <div class="mb-4 p-3 rounded-lg bg-rose-50 border border-rose-200 text-rose-700">
      <i class="ri-error-warning-line mr-1"></i> {{ load_err }}
    </div>
  {% endif %}

  <form method="get" class="flex flex-wrap gap-3 items-end mb-4">
    <div>
      <label class="block text-sm text-slate-600 mb-1">Tìm kiếm</label>
      <input name="q" value="{{ filters.q }}" placeholder="Tên hoặc mã dự án..."
             class="rounded-lg border border-slate-300 px-3 py-2 w-64"/>
    </div>
    <div>
      <label class="block text-sm text-slate-600 mb-1">Trạng thái</label>
      <select name="status" class="rounded-lg border border-slate-300 px-3 py-2">
        <option value="ACTIVE"   {% if filters.status=='ACTIVE' %}selected{% endif %}>ACTIVE</option>
        <option value="INACTIVE" {% if filters.status=='INACTIVE' %}selected{% endif %}>INACTIVE</option>
        <option value="ALL"      {% if filters.status=='ALL' %}selected{% endif %}>ALL</option>
      </select>
    </div>
    <div>
      <button class="px-4 py-2 rounded-lg bg-slate-800 text-white hover:bg-slate-900">
        <i class="ri-search-line mr-1"></i> Lọc
      </button>
    </div>
  </form>

  <div class="overflow-x-auto border border-slate-200 rounded-lg">
    <table class="min-w-full text-sm">
      <thead class="bg-slate-50">
        <tr class="text-left text-slate-600">
          <th class="px-3 py-2 border-b">#</th>
          <th class="px-3 py-2 border-b">Mã</th>
          <th class="px-3 py-2 border-b">Tên dự án</th>
          <th class="px-3 py-2 border-b">Trạng thái</th>
          <th class="px-3 py-2 border-b">Vị trí</th>
          <th class="px-3 py-2 border-b">Thao tác</th>
        </tr>
      </thead>
      <tbody>
      {% for p in page.data %}
        <tr>
          <td class="px-3 py-2 border-b">{{ loop.index + (page.page-1)*page.size }}</td>
          <td class="px-3 py-2 border-b font-mono">{{ p.project_code }}</td>
          <td class="px-3 py-2 border-b">{{ p.name }}</td>
          <td class="px-3 py-2 border-b">{{ p.status }}</td>
          <td class="px-3 py-2 border-b">{{ p.location }}</td>
          <td class="px-3 py-2 border-b">
            <a href="/projects/{{ p.id }}" class="px-2 py-1 rounded border border-slate-300 hover:bg-slate-50">Chi tiết</a>
            {% if me.role in ['SUPER_ADMIN','COMPANY_ADMIN'] %}
              <form method="post" action="/projects/{{ p.id }}/toggle" class="inline"
                    onsubmit="return confirm('Xác nhận {{ 'disable' if p.status=='ACTIVE' else 'enable' }} dự án?')">
                <input type="hidden" name="action" value="{{ 'disable' if p.status=='ACTIVE' else 'enable' }}"/>
                <input type="hidden" name="next" value="/projects?q={{ filters.q }}&status={{ filters.status }}"/>
                <button class="px-2 py-1 rounded border border-slate-300 hover:bg-slate-50">
                  {{ 'Disable' if p.status=='ACTIVE' else 'Enable' }}
                </button>
              </form>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

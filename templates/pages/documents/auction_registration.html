<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">

  {# Chuẩn bị biến khách hàng để đặt title (gợi ý tên file) #}
  {% set customer = (data.customer or {}) %}
  {% set raw_name = (customer.full_name or '') %}
  {% set filename = (raw_name|title|replace(' ', '')) ~ '_' ~ (customer.cccd or '') ~ '.pdf' %}

  <title>{{ filename }}</title>

  <style>
    /* Lề in thật sự của mỗi trang A4 */
    @page {
      size: A4;
      margin: 18mm 16mm;
    }

    html, body {
      margin: 0;
      padding: 0;
      background: #e5e7eb; /* xám nhạt cho preview */
      font-family: "Times New Roman", Times, serif;
      font-size: 13pt;
      color: #000;
    }

    /* Khung A4 cho màn hình (preview) */
    .page {
      width: 210mm;
      min-height: 297mm;
      margin: 10px auto;
      background: #fff;
      box-shadow: 0 0 6px rgba(0,0,0,0.18);
      box-sizing: border-box;
      padding: 18mm 16mm;  /* chỉ áp dụng cho màn hình */
    }

    @media print {
      html, body {
        background: #ffffff;
      }
      body {
        margin: 0;
        padding: 0;
      }
      .page {
        width: auto;
        min-height: auto;
        margin: 0;
        box-shadow: none;
        padding: 0;  /* lề đã do @page quản */
      }
    }

    .center { text-align: center; }
    .bold { font-weight: 700; }
    .mt-6 { margin-top: 6mm; }
    .mb-4 { margin-bottom: 4mm; }
    .mb-6 { margin-bottom: 6mm; }
    .divider { text-align:center; margin: 2mm 0 6mm; }
    .small { font-size: 11.5pt; }
    .note { font-style: italic; font-size: 11pt; }
    .title { font-size: 18pt; font-weight: 800; text-transform: uppercase; }
    .gov   { font-size: 16pt; font-weight: 800; text-transform: uppercase; }

    /* Bảng thông tin cá nhân + TK hoàn tiền */
    .info-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 4mm;
    }
    .info-table td {
      padding: 1mm 0;
      vertical-align: top;
    }
    .info-label {
      width: 42mm;
      font-weight: 700;
      white-space: nowrap;
    }
    .info-sep {
      width: 4mm;
    }

    /* Bảng lô */
    table.lots {
      width: 100%;
      border-collapse: collapse;
      margin-top: 2mm;
      margin-bottom: 6mm;
      page-break-inside: auto;
    }
    table.lots th,
    table.lots td {
      border: 1px solid #000;
      padding: 4px 6px;
      vertical-align: top;
    }
    table.lots th {
      text-align: center;
    }
    .w-stt   { width: 10mm; }
    .w-name  { width: auto; }
    .w-area  { width: 28mm; text-align: right; }
    .w-price { width: 42mm; text-align: right; }

    .signature {
      width: 60%;
      margin-left: auto;
      text-align: center;
      page-break-inside: avoid;
    }
  </style>
</head>
<body>

<div class="page">

  <!-- Quốc hiệu -->
  <div class="center gov">CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</div>
  <div class="center bold">Độc lập – Tự do – Hạnh phúc</div>
  <div class="divider">-----------------o0o-----------------</div>

  <!-- Tiêu đề -->
  <div class="center title mb-6">PHIẾU ĐĂNG KÝ THAM GIA ĐẤU GIÁ TÀI SẢN</div>

  <!-- Kính gửi -->
  <div class="mb-4">
    <span class="bold">Kính gửi:</span>
    <span class="bold">
      {{ (data.company or {}).name or "" }}
    </span>
  </div>

  {# Rút gọn biến #}
  {% set refund   = data.refund_bank or {} %}
  {% set project  = data.project or {} %}
  {% set lots     = data.lots or [] %}

  <!-- THÔNG TIN CÁ NHÂN (4 dòng: tên, CCCD, địa chỉ, SĐT + Email) -->
  <table class="info-table">
    <tr>
      <td class="info-label">Người đăng ký TGĐG</td>
      <td class="info-sep">:</td>
      <td colspan="4">{{ customer.full_name or "" }}</td>
    </tr>
    <tr>
      <td class="info-label">CCCD/CMND</td>
      <td class="info-sep">:</td>
      <td colspan="4">{{ customer.cccd or "" }}</td>
    </tr>
    <tr>
      <td class="info-label">Nơi thường trú</td>
      <td class="info-sep">:</td>
      <td colspan="4">
        {{ customer.address or "" }}
      </td>
    </tr>
    <tr>
      <td class="info-label">Số điện thoại</td>
      <td class="info-sep">:</td>
      <td style="width: 35mm;">
        {{ customer.phone or "" }}
      </td>

      <td class="info-label">Email</td>
      <td class="info-sep">:</td>
      <td>
        {{ customer.email or "" }}
      </td>
    </tr>
  </table>

  <!-- TÀI KHOẢN NHẬN HOÀN TIỀN ĐẶT TRƯỚC -->
  {% if refund %}
  <table class="info-table mb-4">
    <tr>
      <td class="info-label">Số tài khoản</td>
      <td class="info-sep">:</td>
      <td class="info-value">
        {{ refund.account_number or "" }}
      </td>

      <td class="info-label">Chủ tài khoản</td>
      <td class="info-sep">:</td>
      <td class="info-value">
        {{ refund.account_name or "" }}
      </td>
    </tr>
    <tr>
      <td class="info-label">Tại ngân hàng</td>
      <td class="info-sep">:</td>
      <td class="info-value" colspan="4">
        {{ refund.bank_name or refund.bank_short_name or refund.bank_code or "" }}
      </td>
    </tr>
  </table>
  {% endif %}

  <!-- ĐOẠN NỘI DUNG TĨNH SAU TÀI KHOẢN NGÂN HÀNG -->
  <div class="small mb-4" style="text-align: justify;">
    Trong trường hợp cuộc đấu giá bị tạm dừng, tạm hoãn theo yêu cầu của cơ quan có thẩm quyền hoặc tôi không trúng đấu giá,
    tôi xin được nhận lại số tiền đặt trước đã nộp về số tài khoản nêu trên.
  </div>

  <div class="small mb-4" style="text-align: justify;">
    Tôi xin đăng ký tham gia đấu giá tài sản theo Thông báo đấu giá tài sản và Quy chế đấu giá tài sản do Công ty ban hành
    và cam kết chấp hành đầy đủ các quy định của pháp luật có liên quan.
  </div>

  <!-- Mô tả tài sản (chỉ mô tả dự án, bỏ câu "Quyền sử dụng đất thuộc dự án") -->
  <div class="mb-4 small">
    <span class="bold">Tài sản đấu giá:</span>
    <span class="bold">
      {{ project.description or project.name or "" }}
    </span>
  </div>

  <!-- Bảng lô / thửa (có thể chạy qua nhiều trang, vẫn giữ lề chuẩn nhờ @page margin) -->
  <table class="lots">
    <thead>
      <tr>
        <th class="w-stt">STT</th>
        <th class="w-name">Tên lô / thửa đất</th>
        <th class="w-area">Diện tích (m²)</th>
        <th class="w-price">Giá khởi điểm (VND)</th>
      </tr>
    </thead>
    <tbody>
      {% for lot in lots %}
        {% if 'lot_code' in lot %}
          {% set lot_code = lot.lot_code %}
        {% elif 'lot_number' in lot %}
          {% set lot_code = lot.lot_number %}
        {% else %}
          {% set lot_code = '' %}
        {% endif %}

        {% if 'area_m2' in lot %}
          {% set area = lot.area_m2 %}
        {% else %}
          {% set area = None %}
        {% endif %}

        {% if 'starting_price_vnd' in lot and lot.starting_price_vnd is not none %}
          {% set price = lot.starting_price_vnd %}
        {% elif 'reserve_price_vnd' in lot and lot.reserve_price_vnd is not none %}
          {% set price = lot.reserve_price_vnd %}
        {% elif 'deposit_amount_vnd' in lot and lot.deposit_amount_vnd is not none %}
          {% set price = lot.deposit_amount_vnd %}
        {% else %}
          {% set price = None %}
        {% endif %}

        <tr>
          <td class="center">{{ loop.index }}</td>
          <td>{{ lot_code }}</td>
          <td class="w-area">
            {% if area is not none %}
              {{ "{:,.2f}".format(area|float) }}
            {% endif %}
          </td>
          <td class="w-price">
            {% if price is not none %}
              {{ "{:,.0f}".format(price|float) }}
            {% endif %}
          </td>
        </tr>
      {% endfor %}

      {% if lots|length == 0 %}
      <tr>
        <td class="center">1</td>
        <td>&nbsp;</td>
        <td class="w-area"></td>
        <td class="w-price"></td>
      </tr>
      {% endif %}
    </tbody>
  </table>

  <!-- Cam kết -->
  <div class="bold mb-4">Tôi xin cam kết:</div>
  <ol class="small mb-6" style="margin-top:0;">
    <li>Tôi là người duy nhất đại diện cho hộ gia đình đăng ký tham gia đấu giá lô/thửa đất trên và không thuộc trường hợp không đủ điều kiện đăng ký tham gia đấu giá theo Luật ĐGTS.</li>
    <li>Đã xem tài sản đấu giá, xem giấy tờ về quyền sở hữu, sử dụng tài sản trên. Đã nhận, đọc và hiểu rõ nội dung tại Thông báo đấu giá tài sản và Quy chế đấu giá tài sản của Công ty; tự nguyện đăng ký tham gia đấu giá tại phiên nêu trên.</li>
    <li>Chấp nhận tham gia đấu giá theo hình thức, điều kiện mà Công ty lựa chọn cho phiên đấu giá.</li>
    <li>Khi tham gia đấu giá, tôi cam kết thực hiện đúng Quy chế đấu giá tài sản mà Công ty đã ban hành và các quy định pháp luật có liên quan đến việc bán đấu giá tài sản.</li>
    <li>Không nhận tiền lãi phát sinh của khoản tiền đặt trước (nếu có).</li>
  </ol>

  <!-- Ký tên -->
  <div class="signature">
    <div>…, ngày …. tháng … năm {{ year }}</div>
    <div class="bold">Người đăng ký tham gia đấu giá</div>
    <div class="note">(Ký, ghi rõ họ tên)</div>
  </div>

</div>

</body>
</html>

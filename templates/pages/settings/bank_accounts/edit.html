{% extends "base.html" %}
{% block content %}

<div class="mb-5">
  <h1 class="text-xl font-semibold text-slate-800">
    {% if mode == 'create' %}Thêm tài khoản ngân hàng{% else %}Sửa tài khoản ngân hàng{% endif %}
  </h1>
</div>

{% if load_err %}
  <div class="p-3 rounded bg-red-50 text-red-700 text-sm mb-4">{{ load_err }}</div>
{% endif %}

<form method="post" action="{% if mode == 'create' %}/settings/bank-accounts/create{% else %}/settings/bank-accounts/{{ item.id }}/edit{% endif %}" class="max-w-xl space-y-3">
  <div>
    <label class="label">Ngân hàng</label>
    <select name="bank_code" class="input" required>
      <option value="">-- Chọn ngân hàng --</option>
      {% for b in banks %}
        {% set selected = (item.bank_code if item else '')|upper == (b.code|upper) %}
        <option value="{{ b.code }}" {% if selected %}selected{% endif %}>{{ b.code }} — {{ b.name or b.short_name }}</option>
      {% endfor %}
    </select>
  </div>

  <div>
    <label class="label">Số tài khoản</label>
    <input class="input" name="account_number" value="{{ item.account_number if item else '' }}" required>
  </div>

  <div>
    <label class="label">Tên tài khoản</label>
    <input class="input" name="account_name" value="{{ item.account_name if item else '' }}" placeholder="(tuỳ chọn)">
  </div>

  <div>
    <label class="label">Trạng thái</label>
    <select name="bank_code" class="input" required>
      <option value="">-- Chọn ngân hàng --</option>
      {% for b in banks %}
        {% set code = b.code if b.code is defined else (b['code'] if 'code' in b else '') %}
        {% set name = b.name if b.name is defined else (b['name'] if 'name' in b else code) %}
        {% set selected = (item.bank_code if item else '')|upper == code|upper %}
        <option value="{{ code }}" {% if selected %}selected{% endif %}>
          {{ code }} — {{ name }}
        </option>
      {% endfor %}
    </select>
  </div>

  <div class="pt-2">
    <button class="btn-primary" type="submit">{% if mode == 'create' %}Thêm{% else %}Lưu{% endif %}</button>
    <a class="btn-secondary ml-2" href="/settings/bank-accounts">Huỷ</a>
  </div>
</form>

{% endblock %}

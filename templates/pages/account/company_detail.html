{% extends "base.html" %}
{% block content %}

<a href="/account" class="text-sm text-indigo-600">&larr; Quay lại danh sách công ty</a>

<div class="mt-3 mb-6">
  <h2 class="text-xl font-semibold text-slate-800">Công ty: {{ company_code }}</h2>
  {% if company %}
    <p class="text-slate-500 text-sm">
      Tên: <b>{{ company.name }}</b>
      {% if company.is_active %}<span class="ml-2 text-green-600">Active</span>{% else %}<span class="ml-2 text-slate-500">Disabled</span>{% endif %}
    </p>
  {% endif %}
</div>

{% if load_err %}
  <div class="p-3 rounded bg-red-50 text-red-700 text-sm mb-6">{{ load_err }}</div>
{% endif %}

{# Form tạo user cho công ty này #}
<div class="mb-4">
  <form action="/account/admin/user/create" method="post" class="flex gap-2">
    <input type="hidden" name="company_code" value="{{ company_code }}">
    <input type="hidden" name="next" value="/account/company/{{ company_code }}">
    <input name="username" placeholder="username (a-z0-9_)" class="input" required>
    <input name="password" placeholder="password" type="password" class="input" required>
    <select name="role" class="input">
      <option value="STAFF">STAFF</option>
      <option value="VIEWER">VIEWER</option>
      <option value="ACCOUNTANT">ACCOUNTANT</option>
      <option value="COMPANY_ADMIN">COMPANY_ADMIN</option>
    </select>
    <button class="btn-primary" type="submit">Thêm tài khoản</button>
  </form>
</div>

{# Danh sách user của công ty #}
{% if users and users|length > 0 %}
  <div class="overflow-x-auto border rounded">
    <table class="min-w-full text-sm">
      <thead class="bg-slate-100">
        <tr>
          <th class="px-3 py-2 text-left">ID</th>
          <th class="px-3 py-2 text-left">Username</th>
          <th class="px-3 py-2 text-left">Role</th>
          <th class="px-3 py-2 text-left">Trạng thái</th>
          <th class="px-3 py-2 text-left">Hành động</th>
        </tr>
      </thead>
      <tbody>
        {% for u in users %}
        <tr class="border-t">
          <td class="px-3 py-2">{{ u.id }}</td>
          <td class="px-3 py-2 font-mono">{{ u.username }}</td>
          <td class="px-3 py-2">{{ u.role }}</td>
          <td class="px-3 py-2">
            {% if u.is_active %}<span class="text-green-600">Active</span>
            {% else %}<span class="text-slate-500">Disabled</span>{% endif %}
          </td>
          <td class="px-3 py-2">
            {% if u.is_active %}
              <form action="/account/admin/user/toggle" method="post" class="inline"
                    onsubmit="return confirm('Disable user {{ u.username }} ?');">
                <input type="hidden" name="user_id" value="{{ u.id }}">
                <input type="hidden" name="action" value="disable">
                <input type="hidden" name="next" value="/account/company/{{ company_code }}">
                <button class="btn-secondary" type="submit">Disable</button>
              </form>
            {% else %}
              <form action="/account/admin/user/toggle" method="post" class="inline"
                    onsubmit="return confirm('Enable user {{ u.username }} ?');">
                <input type="hidden" name="user_id" value="{{ u.id }}">
                <input type="hidden" name="action" value="enable">
                <input type="hidden" name="next" value="/account/company/{{ company_code }}">
                <button class="btn-primary" type="submit">Enable</button>
              </form>
            {% endif %}

            <form action="/account/admin/user/set-password" method="post" class="inline ml-2"
                  onsubmit="return confirm('Đặt lại mật khẩu cho {{ u.username }} ?');">
              <input type="hidden" name="user_id" value="{{ u.id }}">
              <input type="hidden" name="next" value="/account/company/{{ company_code }}">
              <input type="password" name="new_password" placeholder="new password" class="input" required>
              <button class="btn-primary" type="submit">Set password</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="text-slate-500 text-sm">Chưa có tài khoản nào cho công ty này.</div>
{% endif %}

{% endblock %}

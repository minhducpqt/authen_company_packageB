{% extends "base.html" %}
{% block title %}Báo cáo thống kê{% endblock %}

{% block content %}
<div class="mb-6">
  <h1 class="text-2xl font-semibold text-slate-900 flex items-center gap-2">
    <i class="ri-bar-chart-2-line text-indigo-600 text-3xl"></i>
    Bảng điều khiển báo cáo
  </h1>
  <p class="text-slate-500 text-sm mt-1">
    Tổng hợp nhanh các báo cáo về lô, khách hàng và mua hồ sơ trong từng dự án.
  </p>
</div>

<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
  <a href="/reports/lots/eligible" class="group bg-white border rounded-2xl p-4 shadow-sm hover:shadow-md transition">
    <div class="flex items-center justify-between mb-3">
      <div>
        <div class="text-xs font-semibold text-indigo-600 uppercase tracking-wide">5.1 A</div>
        <div class="text-base font-semibold text-slate-900 mt-1">Lô đủ điều kiện</div>
      </div>
      <div class="h-10 w-10 rounded-2xl bg-indigo-50 flex items-center justify-center group-hover:bg-indigo-100">
        <i class="ri-checkbox-circle-line text-indigo-600 text-xl"></i>
      </div>
    </div>
    <p class="text-xs text-slate-500">
      Danh sách các lô có &ge; 2 khách đặt tiền, kèm số lượng khách và tổng số tiền đặt trước.
    </p>
  </a>

  <a href="/reports/lots/ineligible" class="group bg-white border rounded-2xl p-4 shadow-sm hover:shadow-md transition">
    <div class="flex items-center justify-between mb-3">
      <div>
        <div class="text-xs font-semibold text-rose-600 uppercase tracking-wide">5.1 B</div>
        <div class="text-base font-semibold text-slate-900 mt-1">Lô KHÔNG đủ điều kiện</div>
      </div>
      <div class="h-10 w-10 rounded-2xl bg-rose-50 flex items-center justify-center group-hover:bg-rose-100">
        <i class="ri-alert-line text-rose-600 text-xl"></i>
      </div>
    </div>
    <p class="text-xs text-slate-500">
      Các lô có 0–1 khách đặt hoặc chưa đạt điều kiện đấu giá.
    </p>
  </a>

  <a href="/reports/lots/deposit-stats" class="group bg-white border rounded-2xl p-4 shadow-sm hover:shadow-md transition">
    <div class="flex items-center justify-between mb-3">
      <div>
        <div class="text-xs font-semibold text-sky-600 uppercase tracking-wide">5.1 C</div>
        <div class="text-base font-semibold text-slate-900 mt-1">Thống kê tiền đặt trước</div>
      </div>
      <div class="h-10 w-10 rounded-2xl bg-sky-50 flex items-center justify-center group-hover:bg-sky-100">
        <i class="ri-funds-line text-sky-600 text-xl"></i>
      </div>
    </div>
    <p class="text-xs text-slate-500">
      Thống kê tiền đặt trước cho từng lô: số khách, tổng tiền, thời điểm đặt đầu/ cuối.
    </p>
  </a>

  <a href="/reports/customers/eligible-lots" class="group bg-white border rounded-2xl p-4 shadow-sm hover:shadow-md transition">
    <div class="flex items-center justify-between mb-3">
      <div>
        <div class="text-xs font-semibold text-emerald-600 uppercase tracking-wide">5.2 A</div>
        <div class="text-base font-semibold text-slate-900 mt-1">KH đủ điều kiện & lô</div>
      </div>
      <div class="h-10 w-10 rounded-2xl bg-emerald-50 flex items-center justify-center group-hover:bg-emerald-100">
        <i class="ri-user-star-line text-emerald-600 text-xl"></i>
      </div>
    </div>
    <p class="text-xs text-slate-500">
      1 dòng = 1 khách + 1 lô đủ điều kiện, có SĐT, email, số tiền đặt & thông tin TK hoàn cọc.
    </p>
  </a>
</div>

<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
  <a href="/reports/customers/not-eligible-lots" class="group bg-white border rounded-2xl p-4 shadow-sm hover:shadow-md transition">
    <div class="flex items-center justify-between mb-3">
      <div>
        <div class="text-xs font-semibold text-rose-600 uppercase tracking-wide">5.2 B</div>
        <div class="text-base font-semibold text-slate-900 mt-1">KH KHÔNG đủ điều kiện & lô</div>
      </div>
      <div class="h-10 w-10 rounded-2xl bg-rose-50 flex items-center justify-center group-hover:bg-rose-100">
        <i class="ri-user-forbid-line text-rose-600 text-xl"></i>
      </div>
    </div>
    <p class="text-xs text-slate-500">
      Khách + lô chưa đủ điều kiện (lô chỉ có 0–1 khách đặt), vẫn kèm TK hoàn cọc để xử lý.
    </p>
  </a>

  <a href="/reports/dossiers/paid/detail" class="group bg-white border rounded-2xl p-4 shadow-sm hover:shadow-md transition">
    <div class="flex items-center justify-between mb-3">
      <div>
        <div class="text-xs font-semibold text-amber-600 uppercase tracking-wide">5.3 A</div>
        <div class="text-base font-semibold text-slate-900 mt-1">Mua hồ sơ — chi tiết</div>
      </div>
      <div class="h-10 w-10 rounded-2xl bg-amber-50 flex items-center justify-center group-hover:bg-amber-100">
        <i class="ri-file-list-3-line text-amber-600 text-xl"></i>
      </div>
    </div>
    <p class="text-xs text-slate-500">
      Chi tiết từng dòng mua hồ sơ theo khách, đơn, loại hồ sơ.
    </p>
  </a>

  <a href="/reports/dossiers/paid/summary" class="group bg-white border rounded-2xl p-4 shadow-sm hover:shadow-md transition">
    <div class="flex items-center justify-between mb-3">
      <div>
        <div class="text-xs font-semibold text-violet-600 uppercase tracking-wide">5.3 B</div>
        <div class="text-base font-semibold text-slate-900 mt-1">Mua hồ sơ — tổng hợp</div>
      </div>
      <div class="h-10 w-10 rounded-2xl bg-violet-50 flex items-center justify-center group-hover:bg-violet-100">
        <i class="ri-pie-chart-2-line text-violet-600 text-xl"></i>
      </div>
    </div>
    <p class="text-xs text-slate-500">
      Tổng hợp theo khách & theo loại hồ sơ, phục vụ chốt số liệu.
    </p>
  </a>
</div>

{# ===== DỰ ÁN ĐANG HOẠT ĐỘNG (CARD VIEW) ===== #}
<div class="bg-white border rounded-2xl shadow-sm p-4">
  <div class="flex items-center justify-between mb-4">
    <div>
      <div class="text-sm font-semibold text-slate-900 flex items-center gap-2">
        <i class="ri-community-line text-sky-500"></i>
        Dự án đang hoạt động
      </div>
      <p class="text-xs text-slate-500 mt-1">
        Danh sách các dự án ACTIVE hiện tại. Mỗi dự án hiển thị mã, tên rút gọn, vị trí và lối tắt báo cáo.
      </p>
    </div>
  </div>

  {% set projects_list = projects or [] %}
  {% if projects_list|length == 0 %}
    <div class="py-6 text-center text-slate-400 text-sm">
      Chưa có dự án ACTIVE nào hoặc không tải được danh sách dự án.
    </div>
  {% else %}
    <div class="space-y-3">
      {% for p in projects_list %}
        {% set code = p.project_code or p.code %}
        <div class="border border-slate-100 rounded-2xl px-4 py-3 bg-slate-50/60 hover:bg-slate-50 transition">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2 mb-1">
                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-indigo-50 text-indigo-700">
                  {{ code }}
                </span>
                <span class="text-[11px] uppercase tracking-wide text-slate-400">
                  {{ p.product_type or 'LAND' }}
                </span>
              </div>
              <div class="text-sm font-semibold text-slate-900 leading-snug break-words">
                {{ p.name }}
              </div>
              <div class="mt-1 text-xs text-slate-500 flex items-center gap-1">
                <i class="ri-map-pin-line"></i>
                <span class="truncate md:whitespace-normal">
                  {{ p.location or '-' }}
                </span>
              </div>
            </div>

            <div class="flex flex-wrap items-center gap-2 text-xs md:justify-end">
              <a href="/reports/lots/eligible?project={{ code }}"
                 class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-indigo-50 text-indigo-700 hover:bg-indigo-100">
                <i class="ri-checkbox-circle-line"></i>
                <span>Lô đủ</span>
              </a>
              <a href="/reports/lots/ineligible?project={{ code }}"
                 class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-rose-50 text-rose-700 hover:bg-rose-100">
                <i class="ri-alert-line"></i>
                <span>Lô không đủ</span>
              </a>
              <a href="/reports/lots/deposit-stats?project={{ code }}"
                 class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-sky-50 text-sky-700 hover:bg-sky-100">
                <i class="ri-funds-line"></i>
                <span>Tiền đặt</span>
              </a>
              <a href="/reports/customers/eligible-lots?project={{ code }}"
                 class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-emerald-50 text-emerald-700 hover:bg-emerald-100">
                <i class="ri-user-star-line"></i>
                <span>KH đủ</span>
              </a>
              <a href="/reports/dossiers/paid/detail?project={{ code }}"
                 class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-amber-50 text-amber-700 hover:bg-amber-100">
                <i class="ri-file-list-3-line"></i>
                <span>Hồ sơ</span>
              </a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>
{% endblock %}
